<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
      xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      xmlns:i18n="http://xml.zope.org/namespaces/i18n"
      lang="en">
<head>

</head>
<body>
    <metal:css_head define-macro="css_head_slot">
     <tal:css  
        tal:define="navroot context/@@plone_portal_state/navigation_root_url">
        <link rel="stylesheet" type="text/css" 
            tal:attributes="href string:
    ${navroot}/++resource++ageliaco.rd2/bootstrap/css/bootstrap.css"
            />
        <link rel="stylesheet" href="bootstrap/js/themes/blue/style.css" 
            type="text/css" media="print, projection, screen"
            tal:attributes="href string:
                ${navroot}/++resource++ageliaco.rd2/themes/blue/style.css"
         />


        <link rel="stylesheet" href="assets/css/prettify.css"
tal:attributes="href string:${navroot}/++resource++yafowil.widget.multiselect/multi-select/css/multi-select.css"
         />
        <link rel="stylesheet" href="assets/css/prettify.css"
         tal:attributes="href string:
            ${navroot}/++resource++yafowil.widget.multiselect/widget.css"
         />
      <link rel="stylesheet" href="assets/css/font-awesome.css"
         tal:attributes="href string:
    ${navroot}/++resource++ageliaco.rd2/font-awesome/css/font-awesome.min.css"
         />
        <link rel="stylesheet" type="text/css" 
            tal:attributes="href string:
                ${navroot}/++resource++ageliaco.rd2/projet.css"
            />
     </tal:css>
    </metal:css_head>
     


    <metal:js define-macro="js_head_slot">
     <tal:js  define="navroot context/@@plone_portal_state/navigation_root_url">
        <script type="text/javascript" 
    tal:attributes="src string:${navroot}/++resource++ageliaco.rd2/projet.js"
            src="#">
        </script>
        
        <script type="text/javascript"  
    tal:attributes="src string:${navroot}/++resource++plone.app.jquerytools.js">
         </script>
         
        <script type="text/javascript"  
    tal:attributes="src string:
        ${navroot}/++resource++plone.app.jquerytools.form.js">
         </script>

        <script type="text/javascript"  
            tal:attributes="src string:
                ${navroot}/++resource++plone.app.jquerytools.overlayhelpers.js">
         </script>
        <script type="text/javascript"  
            tal:attributes="src string:
                ${navroot}/++resource++ageliaco.rd2/bootstrap/js/bootstrap.js">
         </script>
        <script type="text/javascript"  
                tal:attributes="src string:
                    ${navroot}/++resource++ageliaco.rd2/prettify.min.js">
        </script>
        <script type="text/javascript"  
                tal:attributes="src string:
                    ${navroot}/++resource++yafowil.widget.richtext/widget.js">
        </script>        
        <script type="text/javascript"  
                tal:attributes="src string:
                ${navroot}/++resource++ageliaco.rd2/jquery.tablesorter.min.js">
        </script>

        <script >
        $(document).ready(function() { 
            // call the tablesorter plugin, the magic happens in the markup 
            $("table").tablesorter(); 
        }); 
        </script>
          <script>
          $(function() {
            // run the currently selected effect
            function runEffect() {
              // run the effect
              $( '[id^=effect-]' ).toggle( "slide");
            };
  
            // set effect from select menu value
            $( '[id^=button-]' ).click(function() {
              runEffect();
              return false;
            });
 
            $( '[id^=effect-]' ).show();
          });
          </script>
       </tal:js>
    </metal:js>

<!-- ex: tal:define="authors python:view.authors(projet.getPath())" 
        => authors must be defined
    as a search result of authors -->
    <metal:my define-macro="list_auteurs"
        >
    <tal:block define="authors python:view.authors(view.objectPath)">
    <table  class="table table-striped table-condensed list_projets">
    <tal:auteurs tal:repeat="author authors" >
      <tal:auteur>
           <tr>
           <td><span tal:replace="author/firstname"/> 
            <span tal:replace="author/lastname"/>
  
           </td>
            <td><span tal:condition="not:  
                here/portal_membership/isAnonymousUser"
                tal:content="author/email">email</span>
                </td>
            <td><span  tal:content="python: view.school(author.school)"/>
            </td>  
            </tr>
            <tr tal:condition="python: view.canReviewContent() or view.isOwner()"  
                tal:attributes="id string:effect-${author/id}">
                    <td colspan="2" >
            <table style="width:100%; margin-bottom:0px" class="heures"><tr>
            <th style="text-align:right">Dégrèvement:</th>
            <th style="text-align:right">demandé</th>
            <th style="text-align:right">RD</th>
            <th style="text-align:right">Ecole</th></tr>
            <tr><th>&nbsp;</th>
                <tal:heure repeat="heure python:view.sponsorasked(author)">
                    <td  style="text-align:right"
                        tal:content="heure"/>
                    </tal:heure>
            </tr>
            </table></td>
            <td class="noprint"  tal:condition="view/canModifyContent"><div >
                <ul class="the-icons">
                    <li><a title="Editer cet auteur" class='editAuteur'  
	        tal:attributes="href python:author.getURL() + '/edit'" href="#">
	            <i class="fa fa-pencil"></i>
            </a></li>
            <!--        <li><a title="Supprimer ce-tte participant-e" class='delAuteur'  
	        tal:attributes="href python:author.getURL() + 
	        '/delete_confirmation'" href="#"><i class="icon-remove"></i>

            </a></li>
	        -->
            </ul></div>
            </td>
        </tr>
      </tal:auteur>
    </tal:auteurs>
        <tr tal:condition="python:view.canReviewContent() or 
                view.canModifyContent() or view.isOwner()"
         tal:attributes="id string:effect-${context/id}"><td colspan="3" >
        <table style="width:100%; margin-bottom:0px" ><tr>

            <tr>
                <th>Totaux</th>
                <tal:heure repeat="heure python: view.getSponsoring()">
                    <td  style="text-align:right"
                        tal:content="heure"/>
                    </tal:heure>
            </tr>
        </table></td>
        </tr>            
    </table>
    </tal:block>
    </metal:my>

    <metal:projets define-macro="projets_list"
        >
            
            <div tal:condition="view/canReviewContent">
                <a href="#" class="heures" 
                    tal:attributes="id string:button-hide-hours">
                    <i class="fa fa-clock-o"></i>
                </a>
            </div>
            
            <tal:table>
            <table  class="table table-striped table-condensed tablesorter" 
                id="keywordSearchTable"
             tal:define="isAnonymous here/portal_membership/isAnonymousUser"
             tal:condition="python:len(projects)"> 
            <thead> 
            <tr> 
                <th style="width:50px" tal:condition="view/canReviewContent">Id
                </th> 
                <th>Titre</th> 
                <th >Cycles</th> 
                <th>Participant-e-s</th> 
            </tr> 
            </thead> 
            <tbody> 
                <tal:loop tal:repeat="projet projects">
                   <tr  tal:attributes="class python:
                    oddrow and 'projet_even' or 'projet_odd'"
                        tal:define="oddrow repeat/projet/odd;"> 
                        <td tal:condition="view/canReviewContent">
                        <span > 
                        <a tal:attributes="href projet/getURL"
                           tal:content="projet/id" />
                        </span>
                      </td>
                        <td>
                        <span > 
                        <a tal:attributes="href projet/getURL"
                           tal:content="projet/id" />
                        </span>
                      </td>
                      <td >
                       <span 
                       tal:repeat="cycle python:view.cycles(projet.getPath())">
                        <a tal:attributes="href cycle/getURL"
                           tal:content="cycle/id" /> <br/>
                        </span>
                      </td>
                    <td   class="ProjectAuthors"  
                        tal:define="objectPath python:
                        view.setObjectPath(projet.getPath(),
                            withTotal=view.canReviewContent())">
                    <span 
                    metal:use-macro="context/@@interface/macros/list_auteurs"/>
                    </td>
                </tr>
                </tal:loop>
            </tbody>
            </table> 

        </tal:table>

    </metal:projets>
    
    <metal:keywords define-macro="keyword_search"
        >
            <div tal:content="structure python:view.multiselect()">form</div>  
            <div  tal:define="projects python:view.results()">
                <div metal:use-macro="context/@@interface/macros/projets_list"/>   
            </div>     

    </metal:keywords>


    <metal:plist define-macro="published_projets"
        >
        <div tal:define="projects python:view.projets('published');">
            <div metal:use-macro="context/@@interface/macros/projets_list"/>
        </div>
    </metal:plist>


    
    <metal:projets_menu define-macro="projets_menu"
        >
        <div class="btn-group"  
        tal:define="navroot context/@@plone_portal_state/navigation_root_url">
          <a class="btn dropdown-toggle" data-toggle="dropdown" href="#">
            Autres vues
            <span class="caret"></span>
          </a>
          <ul class="dropdown-menu"  role="menu" aria-labelledby="dLabel">
            <!-- dropdown menu links -->
              <li class="btn-projets-menu active">
                    <a href="#"  
                        tal:attributes="href string:${here/absolute_url}">
                        Projets terminés
                    </a>
                </li>
              <li class="btn-projets-menu">
                    <a href="@@stateview" 
                    tal:attributes="href 
                        string:${here/absolute_url}/@@stateview">
                    Projets par états
                    </a>
                </li>
              <li class="btn-projets-menu">
                    <a href="@@keywordview"  
                        tal:attributes="href 
                            string:${here/absolute_url}/@@keywordview">
                        Recherche par mots-clé
                    </a>
                </li>
              <li class="btn-projets-menu">
                    <a href="@@localsearch"  
                        tal:attributes="href 
                            string:${here/absolute_url}/@@localsearch">
                        Recherche dans les projets
                    </a>
                </li>
              <li class="btn-projets-menu" 
                tal:condition="not:  here/portal_membership/isAnonymousUser">
                    <a href="@@cyclesview"  
                        tal:attributes="href 
                            string:${here/absolute_url}/@@cyclesview">
                        Cycles par états
                    </a>
                </li>
          </ul>
        
        </div>                

    </metal:projets_menu>


    <metal:cycle_list define-macro="cycle_list">

<link rel="stylesheet" type="text/css" media="screen" href="++resource++jquery.datatables/media/css/jquery.dataTables.css">
<link rel="stylesheet" type="text/css" media="screen" href="++resource++jquery.datatables/extras/TableTools/media/css/TableTools.css">
<script type="text/javascript" src="++resource++jquery.datatables.js"></script>
<script type="text/javascript" src="++resource++jquery.datatables/extras/TableTools/media/js/ZeroClipboard.js"></script>
<script type="text/javascript" src="++resource++jquery.datatables/extras/TableTools/media/js/TableTools.js"></script>
<style type="text/css">.clear{clear:both}</style>



        
        
        
        <script> 
var oTable = $('#mydatatable').dataTable({
  "sDom": 'T<"clear">lfrtip',
  "oTableTools": {"sSwfPath": "++resource++jquery.datatables/extras/TableTools/media/swf/copy_csv_xls_pdf.swf"}
});
        </script>
        <script>
$(document).ready(function() {
  $('#example').dataTable( {
      "oLanguage": {
          "sUrl": "@@collective.js.datatables.translation"
      }
  } );
} );
        </script>

<!-- Datatables init for "select" filtering -->
<script>
(function($) {
/*
 * Function: fnGetColumnData
 * Purpose:  Return an array of table values from a particular column.
 * Returns:  array string: 1d data array
 * Inputs:   object:oSettings - dataTable settings object. This is always the last argument past to the function
 *           int:iColumn - the id of the column to extract the data from
 *           bool:bUnique - optional - if set to false duplicated values are not filtered out
 *           bool:bFiltered - optional - if set to false all the table data is used (not only the filtered)
 *           bool:bIgnoreEmpty - optional - if set to false empty values are not filtered from the result array
 * Author:   Benedikt Forchhammer <b.forchhammer /AT\ mind2.de>
 */
$.fn.dataTableExt.oApi.fnGetColumnData = function ( oSettings, iColumn, bUnique, bFiltered, bIgnoreEmpty ) {
    // check that we have a column id
    if ( typeof iColumn == "undefined" ) return new Array();
     
    // by default we only want unique data
    if ( typeof bUnique == "undefined" ) bUnique = true;
     
    // by default we do want to only look at filtered data
    if ( typeof bFiltered == "undefined" ) bFiltered = true;
     
    // by default we do not want to include empty values
    if ( typeof bIgnoreEmpty == "undefined" ) bIgnoreEmpty = true;
     
    // list of rows which we're going to loop through
    var aiRows;
     
    // use only filtered rows
    if (bFiltered == true) aiRows = oSettings.aiDisplay;
    // use all rows
    else aiRows = oSettings.aiDisplayMaster; // all row numbers
 
    // set up data array   
    var asResultData = new Array();
     
    for (var i=0,c=aiRows.length; i<c; i++) {
        iRow = aiRows[i];
        var aData = this.fnGetData(iRow);
        var sValue = aData[iColumn];
         
        // ignore empty values?
        if (bIgnoreEmpty == true && sValue.length == 0) continue;
 
        // ignore unique values?
        else if (bUnique == true && jQuery.inArray(sValue, asResultData) > -1) continue;
         
        // else push the value onto the result data array
        else asResultData.push(sValue);
    }
     
    return asResultData;
}}(jQuery));
 
 
function fnCreateSelect( aData )
{
    var r='<select><option value=""></option>', i, iLen=aData.length;
    for ( i=0 ; i<iLen ; i++ )
    {
        r += '<option value="'+aData[i]+'">'+aData[i]+'</option>';
    }
    return r+'</select>';
}
 
 
</script>        
        
            <tal:table define="cycles python:view.cycles('/'.join(context.getPhysicalPath()))">
            <table  id="example"  
                    class="display" 
             tal:define="isAnonymous here/portal_membership/isAnonymousUser"
             tal:condition="python:len(cycles)"> 
            <thead> 
            <tr> 
                <th style="width:50px">Id Cycle</th> 
                <th>Titre</th> 
                <th >Etat</th> 
                <th >Id Auteur</th> 
                <th>Prénom</th> 
                <th>Nom</th> 
                <th>Email</th> 
                <th>Ecole</th> 
                <th>Filière</th> 
                <th>H. Deg</th> 
                <th>H. R&D</th> 
                <th>H. Ecole</th> 
            </tr> 
            </thead> 
            <tbody> 
                <tal:loop tal:repeat="cycle cycles">
                 <tal:block define="cycleURL cycle/getURL;
                                    cycleId cycle/id;
                                    cycleTitle cycle/Title;
                                    cycleState python:view.cycle_state(cycle.review_state);
                                    authors python:view.authors(view.objectPath)">
                  <tal:auteursloop repeat="author authors">
                   <tr tal:define="auteur author/getObject"> 
                        <td>
                        <span > 
                        <a tal:attributes="href cycleURL"
                           tal:content="cycleId" />
                        </span>
                      </td>
                        <td>
                        <span > 
                        <a tal:attributes="href cycleURL"
                           tal:content="cycleTitle" />
                        </span>
                      </td>
                        <td>
                        <span > 
                        <a tal:attributes="href cycleURL"
                    tal:content="cycleState" />
                        </span>
                      </td>
                      <td>
                        <span tal:content="auteur/id"/>
                      </td>
                      <td>
                        <span tal:content="auteur/firstname"/>
                      </td>
                      <td>
                        <span tal:content="auteur/lastname"/>
                      </td>
                      <td>
                        <span tal:content="auteur/email"/>
                      </td>
                      <td>
                        <span tal:content="auteur/school"/>
                      </td>
                      <td>
                        <span tal:content="python:view.ordre(auteur.firstname)"/>
                      </td>
                    <td   class="ProjectAuthors"  
                        tal:define="objectPath python:
                            view.setObjectPath(cycle.getPath(),
                                withTotal=view.canReviewContent())"
                        >
                    <span 
                    metal:use-macro="context/@@interface/macros/list_auteurs"/>
                    </td>
                </tr>
                </tal:block>
                </tal:loop>
            </tbody>
            </table> 

        </tal:table>
        <script>
        $(document).ready(function() {
    /* Initialise the DataTable */
    var oTable = $('#example').dataTable( {
        "oLanguage": {
            "sSearch": "Search all columns:"
        }
    } );
     
    /* Add a select menu for each TH element in the table footer */
    $("tfoot th").each( function ( i ) {
        this.innerHTML = fnCreateSelect( oTable.fnGetColumnData(i) );
        $('select', this).change( function () {
            oTable.fnFilter( $(this).val(), i );
        } );
    } );
} );

</script>
    </metal:cycle_list>
    
</body>
</html>